# 実験パラメータ設定書

**バージョン**: 1.0  
**最終更新**: 2024  
**関連コード**: [`scripts/experiment_config.py`](scripts/experiment_config.py)  
**技術詳細**: [`PRESENTATION.md` 710-829行目](PRESENTATION.md#L710-L829)

---

## 概要

本文書は、本研究で使用するすべての実験パラメータの完全な仕様を提供します。パラメータの選択は、理想的な条件から困難な条件まで、さまざまなネットワーク条件下で防御メカニズムを体系的に評価するように設計されています。

---

## コアパラメータ

### 固定パラメータ（全実験共通）

| パラメータ | 値 | 理由 |
|-----------|-----|------|
| `runs` | 200 | モンテカルロ反復回数（95%信頼水準） |
| `num_legit` | 20 | 実行あたりの正規パケット数（典型的なIoT通信サイクル） |
| `num_replay` | 100 | 実行あたりのリプレイ攻撃試行回数（5:1攻撃比率） |
| `seed` | 42 | 再現性を確保する固定乱数シード |
| `attack_mode` | `post` | 事後攻撃スケジューリング（実験1-2） |
| `attacker_loss` | 0.0 | 理想的攻撃者の仮定（記録損失なし） |

### 可変パラメータ（実験固有）

| 実験 | 可変パラメータ | 範囲 | 固定条件 | 出力 |
|------|--------------|------|---------|------|
| 実験1 | `p_loss` | 0.0 - 0.30（ステップ0.05） | `p_reorder=0.0` | Figure 1 |
| 実験2 | `p_reorder` | 0.0 - 0.30（ステップ0.05） | `p_loss=0.10` | Figure 2 |
| 実験3 | `window_size` | 1, 3, 5, 7, 9, 15, 20 | `p_loss=0.15, p_reorder=0.15` | Figure 3 |

---

## 実験1：パケット損失の影響

**目的**：異なるパケット損失条件下での防御メカニズムの可用性を評価する。

**設定**：
```python
p_loss = [0.0, 0.05, 0.10, 0.15, 0.20, 0.25, 0.30]
p_reorder = 0.0
window_size = 5
attack_mode = "post"
runs = 200
seed = 42
```

**パラメータ範囲の設計**：

| 損失率 | ネットワーク状態 | 適用コンテキスト |
|--------|----------------|----------------|
| 0.0 (0%) | 理想的チャネル | ベースライン性能評価 |
| 0.05 (5%) | 良好な屋内 | 短距離、最小干渉 |
| 0.10 (10%) | 典型的環境 | 一般的なIoT展開シナリオ |
| 0.15 (15%) | 劣化環境 | 中程度の干渉が存在 |
| 0.20 (20%) | 悪環境 | 障害物のある産業環境 |
| 0.25 (25%) | 深刻な干渉 | 強い電磁干渉 |
| 0.30 (30%) | ストレステスト | 実用的評価の上限 |

**0-30%範囲の理由**：
- 理論的性能比較のための理想的ベースライン（0%）を含む
- 典型的なIoTシナリオ（5-15%）をカバー
- ロバスト性評価のための困難な条件（15-30%）に拡張
- 30%を超えるとネットワークは実質的に使用不可（防御評価に不適切）

**予想される結果**：
- 防御なし：Avg Attack ≈ 100%（すべての損失率）
- ローリングカウンタ：Avg Legit が損失率とともに大幅に低下
- スライディングウィンドウ：Avg Legit はより緩やかに低下
- チャレンジ・レスポンス：通信オーバーヘッドにより Avg Legit がわずかに影響

**再現方法**：
```bash
python scripts/run_sweeps.py \
  --runs 200 --seed 42 \
  --p-loss-values 0.0 0.05 0.10 0.15 0.20 0.25 0.30 \
  --p-loss-output results/p_loss_sweep.json
```

**出力ファイル**：
- データ：`results/p_loss_sweep.json`
- 図表：`figures/p_loss_legit.png`, `figures/p_loss_attack.png`

---

## 実験2：パケット並び替えの影響

**目的**：並び替えに対するスライディングウィンドウの堅牢性とローリングカウンタの脆弱性を示す。

**設定**：
```python
p_reorder = [0.0, 0.05, 0.10, 0.15, 0.20, 0.25, 0.30]
p_loss = 0.10
window_size = 5
attack_mode = "post"
runs = 200
seed = 42
```

**なぜ p_loss = 0.10 を固定するのか？**  
並び替えの影響を分離するため、パケット損失率を代表的な10%（典型的なIoT環境）に固定します。これは実験設計における単一変数制御の原則に従います。

**パラメータ範囲の設計**：

| 並び替え率 | ネットワークトポロジ | 特徴 |
|-----------|-------------------|------|
| 0.0 (0%) | 単一ホップ理想 | 直接通信、バッファリングなし |
| 0.05 (5%) | 単一ホップ実際 | わずかなMAC再送遅延 |
| 0.10 (10%) | 2ホップネットワーク | バッファキューによる若干の並び替え |
| 0.15 (15%) | 3ホップネットワーク | マルチホップ転送による遅延ジッタ |
| 0.20 (20%) | マルチホップストレス | 顕著な遅延変動 |
| 0.25 (25%) | 複雑なトポロジ | マルチパスルーティング、負荷不均衡 |
| 0.30 (30%) | ストレステスト | ロバスト性評価のための極端な並び替え |

**予想される結果**（重要な発見）：
- ローリングカウンタ：Avg Legit が急激に低下（並び替えパケットがリプレイとして拒否）
  - 0%並び替え：100%可用性
  - 30%並び替え：~40-60%可用性
- スライディングウィンドウ：Avg Legit は安定を維持（並び替えを許容するよう設計）
  - 0-30%並び替え：90-100%の可用性を維持
- チャレンジ・レスポンス：通信オーバーヘッドによりわずかに低下

*この実験は、実際のネットワークにおける厳密なカウンタベースの防御の根本的な限界を明らかにします。*

**再現方法**：
```bash
python scripts/run_sweeps.py \
  --runs 200 --seed 42 \
  --p-reorder-values 0.0 0.05 0.10 0.15 0.20 0.25 0.30 \
  --p-reorder-output results/p_reorder_sweep.json
```

**出力ファイル**：
- データ：`results/p_reorder_sweep.json`
- 図表：`figures/p_reorder_legit.png`, `figures/p_reorder_attack.png`

---

## 実験3：ウィンドウサイズのトレードオフ

**目的**：セキュリティと可用性のバランスを取る最適なスライディングウィンドウサイズを特定する。

**設定**：
```python
window_size = [1, 3, 5, 7, 9, 15, 20]
p_loss = 0.15
p_reorder = 0.15
attack_mode = "inline"
runs = 200
seed = 42
```

**なぜインライン攻撃モードを使用するのか？**  
インライン攻撃（正規トラフィック中に注入されるリプレイ）は、事後攻撃よりも防御が困難です。これにより、ウィンドウサイズのトレードオフをより厳格に評価できます。

**なぜ p_loss = p_reorder = 0.15 なのか？**  
中程度のネットワークストレス（15%の損失と並び替え）により、セキュリティと可用性のトレードオフが最も観察しやすい現実的な困難な条件が作られます。

**ウィンドウサイズのトレードオフ分析**：

| ウィンドウサイズ | セキュリティ | 可用性 | 備考 |
|---------------|------------|--------|------|
| 1 | 最高 | 最低 | 厳密な順序、遅延があると拒否 |
| 3 | 高 | 低 | 2パケットの順序狂いを許容 |
| **5** | **バランス** | **バランス** | **推奨値：良好なセキュリティと可用性** |
| 7 | 良好 | 良好 | より高い許容度、セキュリティは依然として許容可能 |
| 9 | 中程度 | 高 | 良好な可用性、セキュリティが低下し始める |
| 15 | 低 | 非常に高い | ウィンドウが大きすぎ、リプレイウィンドウが増加 |
| 20 | 非常に低い | 最高 | 防御なしシナリオに近づく |

**予想される結果**：
- Avg Legit：ウィンドウサイズとともに増加（W=1: ~80%, W=5: ~95%, W=20: ~98%）
- Avg Attack：ウィンドウサイズとともに増加（W=1: ~2%, W=5: ~5%, W=20: ~15%）
- 最適バランス：W = 5-7（可用性 >95%、攻撃率 <10%）

**再現方法**：
```bash
python scripts/run_sweeps.py \
  --runs 200 --seed 42 \
  --window-values 1 3 5 7 9 15 20 \
  --attack-mode inline \
  --window-output results/window_sweep.json
```

**出力ファイル**：
- データ：`results/window_sweep.json`
- 図表：`figures/window_tradeoff.png`

---

## パラメータ範囲の正当化

### 統計的考慮事項

**モンテカルロ実行回数（n=200）**：
- 信頼水準：95%（α = 0.05）
- 標準誤差：±2-3%
- 防御メカニズム間の統計的に有意な差異を観察するのに十分
- 性能：200回の実行で約5.3秒（実測）

**正規パケット数（n=20）**：
- 典型的なIoT通信セッションを表す（例：センサーが10秒ごとに3-5分間報告）
- 現実性と計算効率のバランス
- 公平な比較のためすべての実験で固定

**リプレイ試行回数（n=100）**：
- 5:1の攻撃対正規比率は高脅威シナリオを表す
- 攻撃成功率の正確な推定に十分なサンプルサイズ
- セキュリティ評価のベストプラクティスに準拠

### ネットワークパラメータ範囲

**重要な注意事項**：本研究で使用される具体的な数値範囲（例：「0-30%のパケット損失」）は、**体系的評価のために設計されたシミュレーションパラメータ**であり、単一の文献ソースからの直接的な測定値ではありません。これらの範囲は以下により設計されました：

1. **文献背景**：IEEE 802.15.4、LoRaWAN、BLE展開における短距離無線ネットワーク信頼性の定性的記述を参照
2. **カバレッジ原則**：理想的条件から困難な条件までの完全な範囲で、防御メカニズムの動作を完全に特徴づける
3. **実用的関連性**：ネットワークが使用可能な範囲に焦点（極端な障害シナリオを除外）

**参照背景文献**（定性的背景）：
- IEEE 802.15.4/ZigBee：Baronti et al. (2007) - 産業環境の変動性
- LoRaWAN：Haxhibeqiri et al. (2018) - 都市展開の課題
- BLE：Gomez et al. (2012) - 2.4GHz干渉の影響
- 産業WSN：Sha et al. (2017) - 工場信頼性研究

詳細な議論：[`PRESENTATION.md` 710-829行目](PRESENTATION.md#L710-L829)

---

## 再現性

すべての実験は `seed=42` を使用して、実行間で同一の結果を保証します。完全なワークフロー：

1. パラメータスイープの実行：`python scripts/run_sweeps.py --runs 200 --seed 42`
2. 図表の生成：`python scripts/plot_results.py`
3. テーブルのエクスポート：`python scripts/export_tables.py`

結果は `results/` ディレクトリにJSONファイルとして保存され、完全な設定メタデータが含まれます。

---

## 実装

本文書で定義されたパラメータは以下に実装されています：
- コード設定：[`scripts/experiment_config.py`](scripts/experiment_config.py)
- 実行スクリプト：[`scripts/run_sweeps.py`](scripts/run_sweeps.py)
- チャネルモデル：[`sim/channel.py`](sim/channel.py)

パラメータ設定のテスト：
```bash
python scripts/experiment_config.py  # パラメータ概要を出力
```

---

## バージョン履歴

**v1.0**（2024）
- 初期パラメータ仕様
- 3つのコア実験を定義
- 統計的正当化を文書化

---

## 参考文献

詳細な技術実装と理論的背景については、以下を参照してください：
- メインドキュメント：[`PRESENTATION.md`](PRESENTATION.md)
- プロジェクトREADME：[`README.ja.md`](README.ja.md)
- コードリポジトリ：[GitHub](https://github.com/tammakiiroha/Replay-simulation)

